function isJSON(b){try{var a=JSON.parse(b);if(a&&"object"===typeof a)return!0}catch(c){}return!1}function dec2hex(d){return Number(d).toString(16)}function hex2dec(h){return parseInt(h,16)}function randomElement(ar){return ar[Math.floor(Math.random()*ar.length)]}function isset(obj){var i,max_i;if(obj===undefined)return false;for(i=1,max_i=arguments.length;i<max_i;i++){if(obj[arguments[i]]===undefined){return false}obj=obj[arguments[i]]}return true}function debounce(func,wait,immediate){var timeout;return function(){var context=this,args=arguments;var later=function(){timeout=null;if(!immediate)func.apply(context,args)};var callNow=immediate&&!timeout;clearTimeout(timeout);timeout=setTimeout(later,wait);if(callNow)func.apply(context,args)}}Promise.settle=function(promises){var results=[];var done=promises.length;return new Promise(function(resolve){function tryResolve(i,v){results[i]=v;done=done-1;if(done==0)resolve(results)}for(var i=0;i<promises.length;i++)promises[i].then(tryResolve.bind(null,i),tryResolve.bind(null,i));if(done==0)resolve(results)})};function hexToRgb(hex){var shorthandRegex=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;hex=hex.replace(shorthandRegex,function(m,r,g,b){return r+r+g+g+b+b});var result=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);return result?{r:parseInt(result[1],16),g:parseInt(result[2],16),b:parseInt(result[3],16)}:null}Array.prototype.asyncEach=function(iterator,done){var list=this,n=list.length,i=-1,calls=0,looping=false;var iterate=function(){calls-=1;i+=1;if(i===n){done();return}iterator(list[i],i,resume)};var loop=function(){if(looping)return;looping=true;while(calls>0)iterate();looping=false};var resume=function(){calls+=1;if(typeof setTimeout==="undefined")loop();else setTimeout(iterate,1)};resume()};if("undefined"==typeof window.Element){window.Element=function(){return{prototype:{}}}();var __getElementById=document.getElementById,__createElement=document.createElement;document.getElementById=function(a){a=__getElementById(a);for(var d in Element)a[d]=Element[d];for(var b in Element.prototype)a[b]=Element.prototype[b]};document.createElement=function(a){__createElement(a)}}Element.prototype.setAttributes=function(a){var d=function(b,a){for(var c in b)"object"==typeof b[c]&&null==b[c].dataset&&null==b[c][0]?d(b[c],a[c]):a[c]=b[c]};d(a,this)};var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t="";var n,r,i,s,o,u,a;var f=0;e=Base64._utf8_encode(e);while(f<e.length){n=e.charCodeAt(f++);r=e.charCodeAt(f++);i=e.charCodeAt(f++);s=n>>2;o=(n&3)<<4|r>>4;u=(r&15)<<2|i>>6;a=i&63;if(isNaN(r)){u=a=64}else if(isNaN(i)){a=64}t=t+this._keyStr.charAt(s)+this._keyStr.charAt(o)+this._keyStr.charAt(u)+this._keyStr.charAt(a)}return t},decode:function(e){var t="";var n,r,i;var s,o,u,a;var f=0;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(f<e.length){s=this._keyStr.indexOf(e.charAt(f++));o=this._keyStr.indexOf(e.charAt(f++));u=this._keyStr.indexOf(e.charAt(f++));a=this._keyStr.indexOf(e.charAt(f++));n=s<<2|o>>4;r=(o&15)<<4|u>>2;i=(u&3)<<6|a;t=t+String.fromCharCode(n);if(u!=64){t=t+String.fromCharCode(r)}if(a!=64){t=t+String.fromCharCode(i)}}t=Base64._utf8_decode(t);return t},_utf8_encode:function(e){e=e.replace(/\r\n/g,"\n");var t="";for(var n=0;n<e.length;n++){var r=e.charCodeAt(n);if(r<128){t+=String.fromCharCode(r)}else if(r>127&&r<2048){t+=String.fromCharCode(r>>6|192);t+=String.fromCharCode(r&63|128)}else{t+=String.fromCharCode(r>>12|224);t+=String.fromCharCode(r>>6&63|128);t+=String.fromCharCode(r&63|128)}}return t},_utf8_decode:function(e){var t="";var n=0;var r=c1=c2=0;while(n<e.length){r=e.charCodeAt(n);if(r<128){t+=String.fromCharCode(r);n++}else if(r>191&&r<224){c2=e.charCodeAt(n+1);t+=String.fromCharCode((r&31)<<6|c2&63);n+=2}else{c2=e.charCodeAt(n+1);c3=e.charCodeAt(n+2);t+=String.fromCharCode((r&15)<<12|(c2&63)<<6|c3&63);n+=3}}return t}};!function(a){"use strict";function b(a,b){var c=(65535&a)+(65535&b),d=(a>>16)+(b>>16)+(c>>16);return d<<16|65535&c}function c(a,b){return a<<b|a>>>32-b}function d(a,d,e,f,g,h){return b(c(b(b(d,a),b(f,h)),g),e)}function e(a,b,c,e,f,g,h){return d(b&c|~b&e,a,b,f,g,h)}function f(a,b,c,e,f,g,h){return d(b&e|c&~e,a,b,f,g,h)}function g(a,b,c,e,f,g,h){return d(b^c^e,a,b,f,g,h)}function h(a,b,c,e,f,g,h){return d(c^(b|~e),a,b,f,g,h)}function i(a,c){a[c>>5]|=128<<c%32,a[(c+64>>>9<<4)+14]=c;var d,i,j,k,l,m=1732584193,n=-271733879,o=-1732584194,p=271733878;for(d=0;d<a.length;d+=16)i=m,j=n,k=o,l=p,m=e(m,n,o,p,a[d],7,-680876936),p=e(p,m,n,o,a[d+1],12,-389564586),o=e(o,p,m,n,a[d+2],17,606105819),n=e(n,o,p,m,a[d+3],22,-1044525330),m=e(m,n,o,p,a[d+4],7,-176418897),p=e(p,m,n,o,a[d+5],12,1200080426),o=e(o,p,m,n,a[d+6],17,-1473231341),n=e(n,o,p,m,a[d+7],22,-45705983),m=e(m,n,o,p,a[d+8],7,1770035416),p=e(p,m,n,o,a[d+9],12,-1958414417),o=e(o,p,m,n,a[d+10],17,-42063),n=e(n,o,p,m,a[d+11],22,-1990404162),m=e(m,n,o,p,a[d+12],7,1804603682),p=e(p,m,n,o,a[d+13],12,-40341101),o=e(o,p,m,n,a[d+14],17,-1502002290),n=e(n,o,p,m,a[d+15],22,1236535329),m=f(m,n,o,p,a[d+1],5,-165796510),p=f(p,m,n,o,a[d+6],9,-1069501632),o=f(o,p,m,n,a[d+11],14,643717713),n=f(n,o,p,m,a[d],20,-373897302),m=f(m,n,o,p,a[d+5],5,-701558691),p=f(p,m,n,o,a[d+10],9,38016083),o=f(o,p,m,n,a[d+15],14,-660478335),n=f(n,o,p,m,a[d+4],20,-405537848),m=f(m,n,o,p,a[d+9],5,568446438),p=f(p,m,n,o,a[d+14],9,-1019803690),o=f(o,p,m,n,a[d+3],14,-187363961),n=f(n,o,p,m,a[d+8],20,1163531501),m=f(m,n,o,p,a[d+13],5,-1444681467),p=f(p,m,n,o,a[d+2],9,-51403784),o=f(o,p,m,n,a[d+7],14,1735328473),n=f(n,o,p,m,a[d+12],20,-1926607734),m=g(m,n,o,p,a[d+5],4,-378558),p=g(p,m,n,o,a[d+8],11,-2022574463),o=g(o,p,m,n,a[d+11],16,1839030562),n=g(n,o,p,m,a[d+14],23,-35309556),m=g(m,n,o,p,a[d+1],4,-1530992060),p=g(p,m,n,o,a[d+4],11,1272893353),o=g(o,p,m,n,a[d+7],16,-155497632),n=g(n,o,p,m,a[d+10],23,-1094730640),m=g(m,n,o,p,a[d+13],4,681279174),p=g(p,m,n,o,a[d],11,-358537222),o=g(o,p,m,n,a[d+3],16,-722521979),n=g(n,o,p,m,a[d+6],23,76029189),m=g(m,n,o,p,a[d+9],4,-640364487),p=g(p,m,n,o,a[d+12],11,-421815835),o=g(o,p,m,n,a[d+15],16,530742520),n=g(n,o,p,m,a[d+2],23,-995338651),m=h(m,n,o,p,a[d],6,-198630844),p=h(p,m,n,o,a[d+7],10,1126891415),o=h(o,p,m,n,a[d+14],15,-1416354905),n=h(n,o,p,m,a[d+5],21,-57434055),m=h(m,n,o,p,a[d+12],6,1700485571),p=h(p,m,n,o,a[d+3],10,-1894986606),o=h(o,p,m,n,a[d+10],15,-1051523),n=h(n,o,p,m,a[d+1],21,-2054922799),m=h(m,n,o,p,a[d+8],6,1873313359),p=h(p,m,n,o,a[d+15],10,-30611744),o=h(o,p,m,n,a[d+6],15,-1560198380),n=h(n,o,p,m,a[d+13],21,1309151649),m=h(m,n,o,p,a[d+4],6,-145523070),p=h(p,m,n,o,a[d+11],10,-1120210379),o=h(o,p,m,n,a[d+2],15,718787259),n=h(n,o,p,m,a[d+9],21,-343485551),m=b(m,i),n=b(n,j),o=b(o,k),p=b(p,l);return[m,n,o,p]}function j(a){var b,c="";for(b=0;b<32*a.length;b+=8)c+=String.fromCharCode(a[b>>5]>>>b%32&255);return c}function k(a){var b,c=[];for(c[(a.length>>2)-1]=void 0,b=0;b<c.length;b+=1)c[b]=0;for(b=0;b<8*a.length;b+=8)c[b>>5]|=(255&a.charCodeAt(b/8))<<b%32;return c}function l(a){return j(i(k(a),8*a.length))}function m(a,b){var c,d,e=k(a),f=[],g=[];for(f[15]=g[15]=void 0,e.length>16&&(e=i(e,8*a.length)),c=0;16>c;c+=1)f[c]=909522486^e[c],g[c]=1549556828^e[c];return d=i(f.concat(k(b)),512+8*b.length),j(i(g.concat(d),640))}function n(a){var b,c,d="0123456789abcdef",e="";for(c=0;c<a.length;c+=1)b=a.charCodeAt(c),e+=d.charAt(b>>>4&15)+d.charAt(15&b);return e}function o(a){return unescape(encodeURIComponent(a))}function p(a){return l(o(a))}function q(a){return n(p(a))}function r(a,b){return m(o(a),o(b))}function s(a,b){return n(r(a,b))}function t(a,b,c){return b?c?r(b,a):s(b,a):c?p(a):q(a)}"function"==typeof define&&define.amd?define(function(){return t}):a.md5=t}(this);function dataURItoBlob(b){if(b&&b.indexOf(",")===-1)return;var a=atob(b.split(",")[1]);b=b.split(",")[0].split(":")[1].split(";")[0];for(var d=new ArrayBuffer(a.length),e=new Uint8Array(d),c=0;c<a.length;c++)e[c]=a.charCodeAt(c);a=new DataView(d);return new Blob([a],{type:b})}function dataURItoArrayBuffer(b){var a=atob(b.split(",")[1]);b=b.split(",")[0].split(":")[1].split(";")[0];for(var d=new ArrayBuffer(a.length),e=new Uint8Array(d),c=0;c<a.length;c++)e[c]=a.charCodeAt(c);return d}function obj2url(obj){var str=[];for(var p in obj)if(obj.hasOwnProperty(p)){str.push(encodeURIComponent(p)+"="+encodeURIComponent(obj[p]))}return str.join("&")}function arrayBufferToBase64(buffer){var binary="";var bytes=new Uint8Array(buffer);var len=bytes.byteLength;for(var i=0;i<len;i++){binary+=String.fromCharCode(bytes[i])}return window.btoa(binary)}function base64ToArrayBuffer(base64){var binary_string=window.atob(base64);var len=binary_string.length;var bytes=new Uint8Array(len);for(var i=0;i<len;i++){bytes[i]=binary_string.charCodeAt(i)}return bytes.buffer}var getSiblings=function(elem){var siblings=[];var sibling=elem.parentNode.firstChild;for(;sibling;sibling=sibling.nextSibling){if(sibling.nodeType===1&&sibling!==elem){siblings.push(sibling)}}return siblings};function safeGetProp(obj,props,defaultValue){try{return props.split(".").reduce(function lib_safeGetProp(obj,p){return obj[p]},obj)}catch(e){return defaultValue}}function PopupCenter(a,d,b,c){var e=void 0!=window.screenLeft?window.screenLeft:screen.left,f=void 0!=window.screenTop?window.screenTop:screen.top;width=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width;height=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height;a=window.open(a,d,"scrollbars=yes, width="+b+", height="+c+", top="+(height/2-c/2+f)+", left="+(width/2-b/2+e)+", resizable=yes");window.focus&&a.focus()}Handlebars.registerHelper("compare",function(g,c,e,d){var f;if(3>arguments.length)throw Error("'compare' needs 2 parameters");void 0===d&&(d=e,e=c,c="===");f={"==":function(a,b){return a==b},"===":function(a,b){return a===b},"!=":function(a,b){return a!=b},"!==":function(a,b){return a!==b},"<":function(a,b){return a<b},">":function(a,b){return a>b},"<=":function(a,b){return a<=b},">=":function(a,b){return a>=b},in:function(a,b){return b&&-1!=b.indexOf(a)},typeof:function(a,b){return typeof a==b}};if(!f[c])throw Error("Malformed operator in 'compare'; "+c);return f[c](g,e)?d.fn(this):d.inverse(this)});Handlebars.registerHelper("json",function(context){return JSON.stringify(context)});Handlebars.registerHelper("log",function(context){console.dir(context)});window.Object.defineProperty(Element.prototype,"documentOffsetTop",{get:function(){return this.offsetTop+(this.offsetParent?this.offsetParent.documentOffsetTop:0)}});window.Object.defineProperty(Element.prototype,"documentOffsetLeft",{get:function(){return this.offsetLeft+(this.offsetParent?this.offsetParent.documentOffsetLeft:0)}});Element.prototype.empty=function(){while(this.firstChild){this.removeChild(this.firstChild)}};Element.prototype.remove=function(){this.parentElement.removeChild(this)};NodeList.prototype.remove=HTMLCollection.prototype.remove=function(){for(var i=0,len=this.length;i<len;i++){if(this[i]&&this[i].parentElement){this[i].parentElement.removeChild(this[i])}}};function isInDOMTree(a){return!!findUltimateAncestor(a).body}function findUltimateAncestor(a){for(;a.parentNode;)a=a.parentNode;return a}function xhrFields(fields){var qs=[];for(var i in fields){if(fields.hasOwnProperty(i)&&fields[i]!==null){qs.push([encodeURIComponent(i),encodeURIComponent(fields[i])].join("="))}}return qs.join("&")}if(!String.prototype.trim){(function(){var rtrim=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;String.prototype.trim=function(){return this.replace(rtrim,"")}})()}(function(){String.prototype.trimExtn=function(){return this.replace(/\.[^.]*$/,"")}})();(function(){String.prototype.trimUntilExtn=function(){return this.replace(/.*\./,"")}})();var hexToRgb=function(hex){var result=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);return result?{r:parseInt(result[1],16),g:parseInt(result[2],16),b:parseInt(result[3],16)}:null};var darkOrLight=function(red,green,blue){var brightness;brightness=red*299+green*587+blue*114;brightness=brightness/255e3;if(brightness>=.5){return"#000"}else{return"#fff"}};function aspectRatio(b,c,a,d){a=Math.min(a/b,d/c);return{width:b*a,height:c*a}}localforage.config({name:"DocumentNinja"});function Clone(a){var b;if(null==a||"object"!=typeof a)return a;if(a instanceof Date)return b=new Date,b.setTime(a.getTime()),b;if(a instanceof Array){b=[];for(var c=0,d=a.length;c<d;c++)b[c]=Clone(a[c]);return b}if(a instanceof Object){b={};for(c in a)a.hasOwnProperty(c)&&(b[c]=Clone(a[c]));return b}throw Error("Unable to copy obj! Its type isn't supported.")}function getObjects(obj,key,val){var objects=[];for(var i in obj){if(!obj.hasOwnProperty(i))continue;if(typeof obj[i]=="object"){objects=objects.concat(getObjects(obj[i],key,val))}else if(i==key&&obj[i]==val||i==key&&val==""){objects.push(obj)}else if(obj[i]==val&&key==""){if(objects.lastIndexOf(obj)==-1){objects.push(obj)}}}return objects}function scrollIfNeeded(element,container){if(element.offsetTop<container.scrollTop){container.scrollTop=element.offsetTop}else{var offsetBottom=element.offsetTop+element.offsetHeight;var scrollBottom=container.scrollTop+container.offsetHeight;if(offsetBottom>scrollBottom){container.scrollTop=offsetBottom-container.offsetHeight}}}function apiProxy(){this.LMSInitialize=function(){return"true"},this.LMSFinish=function(){return"true"},this.LMSGetValue=function(param){switch(param){case"cmi.core.lesson_status":break}return""},this.LMSSetValue=function(param,value){switch(param){case"cmi.score.raw":break;case"cmi.core.lesson_location":break}return"true"},this.LMSCommit=function(param){return"true"},this.LMSGetLastError=function(){return 0},this.LMSGetErrorString=function(){return"No error"},this.LMSGetDiagnostic=function(param){return param}}var ninjaApiProxy=new apiProxy;function checkTimeSpent(data,pageIndex){var n,d,$obj=$("#timeTaken"),$score=$("#pageScore");typeof data==="object"?data.hasOwnProperty("slide")?(n=+data.slide||0,d=+data.total||0):(n=+data.seconds||0,d=+data.duration||0):(n=+data||0,d=+pageIndex||0);var pc=Math.round(n/d*100);if($score.length){$score.text(n+" of "+d+"("+pc+"%)")}else{var outp=formatSeconds(n);if(isNaN(d)||d===0){}else{outp+=" / "+formatSeconds(d)+" ("+pc+"%)"}$obj.text(outp)}}function formatSeconds(seconds){var date=new Date(1970,0,1);date.setSeconds(seconds);return date.toTimeString().replace(/.*(\d{2}:\d{2}:\d{2}).*/,"$1").replace(/^00:(.*)/,"$1")}function CancelThis(elem){$(elem).closest("li").remove();setItemOrder()}function CancelConversion(fileId){var liElem=document.querySelector("li[data-fileid='"+fileId+"']");liElem.parentNode.removeChild(liElem);setItemOrder()}function setGlobalVars(){DocNinja.options.MUTED=document.body.classList.contains("mute");DocNinja.options.AUTOSPLIT=!document.body.classList.contains("no-autosplit");DocNinja.options.AUTOOPTIMISE=!document.body.classList.contains("no-autoresize");DocNinja.options.AUTOCENTER=!document.body.classList.contains("no-autocenter");DocNinja.options.PDFEMBED=!document.body.classList.contains("no-pdfembed");DocNinja.options.PDFTOOLS=!document.body.classList.contains("no-pdftoolbar")}window.addEventListener("statuschange",function(e){switch(e.detail.status){case"resit":localforage.getItem(e.detail.id,function action_plugin_view_get(err,value){var frame=document.getElementById("preview-frame");frame.removeAttribute("data-fileid");frame.setAttribute("src","plugins/QuizBuilder/view.html?"+e.detail.id)});break;default:checkTimeSpent(e.detail);break}},false);function triggerResize(){var event;if(document.createEvent){event=document.createEvent("HTMLEvents");event.initEvent("resize",true,true)}else{event=document.createEventObject();event.eventType="resize"}event.eventName="resize";if(document.createEvent){window.dispatchEvent(event)}else{window.fireEvent("on"+event.eventType,event)}}var _g_popover_target;function closePopover(e){var b=document.querySelector("div.dn-backdrop");b.removeEventListener("click",closePopover);document.body.removeChild(b);document.body.removeChild(document.querySelector("div.dn-popover"))}function handlePopover(tgt){_g_popover_target=tgt;var rekt=tgt.getBoundingClientRect(),b=document.createElement("div"),d=Object.assign({actions:DocNinja.options.actions},tgt.dataset);b.addEventListener("click",closePopover,false);b.classList.add("dn-backdrop");document.body.appendChild(b);b=document.createElement("div");b.classList.add("dn-popover");b.dataset.source=tgt.dataset.action;b.innerHTML=Handlebars.templates["popovers"](d);b.style.top=rekt.y+rekt.height+10+"px";b.style.right="calc((100vw + .5em) - "+(rekt.x+rekt.width)+"px)";document.body.appendChild(b);switch(tgt.dataset.action){case"toggle-settings":$("input[data-action='toggle-mute']").prop("checked",!DocNinja.options.MUTED);$("input[data-action='toggle-no-autosplit']").prop("checked",DocNinja.options.AUTOSPLIT);$("input[data-action='toggle-no-autoresize']").prop("checked",DocNinja.options.AUTOOPTIMISE);$("input[data-action='toggle-no-autocenter']").prop("checked",DocNinja.options.AUTOCENTER);$("input[data-action='toggle-no-pdftoolbar']").prop("checked",DocNinja.options.PDFTOOLS);$("input[data-action='toggle-no-pdfembed']").prop("checked",DocNinja.options.PDFEMBED);break;case"page-layout":$("input[value='left']").prop("checked",tgt.dataset.value==="left");$("input[value='center']").prop("checked",tgt.dataset.value==="center");break;case"toggle-add-content":b.style.right="initial";b.style.minWidth="375px";b.style.left="10px";b.style.top=rekt.y+rekt.height+9+"px";break;break}if(!DocNinja.options.MUTED)playSound(DocNinja.options.sndpop);if("init"in tgt.dataset){switch(tgt.dataset.init){case"jscolor":var picker=new jscolor(b.querySelector("button.jscolor"),{valueElement:"color_value",value:tgt.dataset.value?tgt.dataset.value:DocNinja.options.pageBackgroundColour,onFineChange:debounce(function(){previewPageBackground(this.toHEXString())},500),hash:true});break;case"scoreslider":var el=document.getElementById("score_slider");noUiSlider.create(el,{start:[el.dataset.value],tooltips:[{to:function(val){return Math.round(val)}}],range:{min:+el.dataset.min,max:+el.dataset.max},step:1,pips:{mode:"count",values:Math.max(2,el.dataset.max/7>>0),density:5}});break;case"rangeslider":var el=document.getElementById("range_slider");noUiSlider.create(el,{start:[el.dataset.value],tooltips:[{to:function(val){return Math.round(val)+"%"}}],range:{min:+el.dataset.min,max:+el.dataset.max},step:1,pips:{mode:"values",values:[1,20,40,60,80,100],density:5}});break;case"initaudio":var id=DocNinja.filePreview.CurrentFile();var audio=document.getElementById("popover_audioElement");if(audio.src){audio.classList.add("visible")}else{audio.classList.remove("visible")}localforage.getItem(id).then(function(obj){document.getElementById("popover_audioElement").src=obj.payload.mp3;document.getElementById("pageAudioNav").checked=obj.autoNav});break;case"initAttachments":var dest=document.getElementById("page-file-attachments");var id=DocNinja.filePreview.CurrentFile();dest.innerHTML="";localforage.getItem(id).then(function(obj){if(obj.hasOwnProperty("attachments"))[].forEach.call(obj.attachments,function feAttachment(file){dest.insertAdjacentHTML("beforeend",Handlebars.templates["page-attachment"](file))})});break}}}function playSound(obj){Promise.resolve(obj.play()).catch(function(ex){console.dir(ex)})}function handleAction(node,e){var tgt=typeof node==="undefined"?_g_popover_target:node;switch(tgt.dataset.action){case"pop-help":var w=window.open(tgt.dataset.url,"_blank");w.focus();break;case"add-content":closePopover();classie.addClass(document.body,"modal-add");if(!DocNinja.options.MUTED)playSound(DocNinja.options.sndpop);break;case"close-add-content":classie.removeClass(document.body,"modal-add");break;case"import-content":classie.addClass(document.body,"modal-import");if(!DocNinja.options.MUTED)playSound(DocNinja.options.sndpop);break;case"close-import-content":classie.removeClass(document.body,"modal-import");break;case"toggle-rename":var li=e.target.closest("[data-fileid]");if(!li)return;var n=li.querySelector("a[data-action='preview']");if(!n)return;renameNode(li.dataset.fileid,n);break;default:performAction(tgt,e)}}function previewPageBackground(colour){DocNinja.filePreview.Editing.ShowBgColour(colour);document.querySelector("input[name='color_value']").value=colour;DocNinja.options.pageBackgroundColour=colour}function popover_saveScore(){var id=DocNinja.filePreview.CurrentFile(),score=document.getElementById("score_slider").noUiSlider.get();localforage.getItem(id).then(function(obj){obj.score=score;closePopover();return localforage.setItem(id,obj)})}function popover_saveRange(){var id=DocNinja.filePreview.CurrentFile(),button=document.querySelector("button[data-init='rangeslider']"),score=document.getElementById("range_slider").noUiSlider.get();button.dataset.value=score;localforage.getItem(id).then(function(obj){obj.score=score;closePopover();return localforage.setItem(id,obj)})}function popover_audioNavToggle(state){var id=DocNinja.filePreview.CurrentFile();localforage.getItem(id).then(function(obj){obj.autoNav=state;localforage.setItem(id,obj)})}function popover_audioUpload(file){var id=DocNinja.filePreview.CurrentFile();if(file&&file.type.indexOf("audio/mpeg")===-1&&file.type.indexOf("audio/mp3")===-1)return;var reader=new FileReader;reader.onloadend=function(event){localforage.getItem(id).then(function(obj){obj.payload.mp3=event.target.result;var updated=DocNinja.Navigation.Icons.Add.Audio(id);document.querySelector("button[data-action='set-audio']").dataset.init="initaudio";closePopover();localforage.setItem(id,obj);if(updated)window.setItemOrder()})};reader.readAsDataURL(file)}function popover_savePageBackground(){var id=DocNinja.filePreview.CurrentFile(),colour=document.querySelector("input[name='color_value']").value.replace("#","");if(document.getElementById("colourAll").checked){closePopover();return DocNinja.Page.ModifyAllPageBackgroundColours(colour)}else{if(null===id){closePopover();return}localforage.getItem(id).then(function(obj){switch(obj.kind){case"iframe":break;case"plugin":case"image":case"video":obj.payload.backgroundColour=colour;break;case"url":obj=DocNinja.Page.ModifyIframeBackgroundColour(obj,colour);break;case"file":obj=DocNinja.Page.ModifyPageBackgroundColour(obj,colour);break;default:alert("OOps! Unhandled page type");console.warn({warning:"Unhandled page type in background colour routine",object:obj})}closePopover();return localforage.setItem(id,obj)})}}function popover_useRecording(mp3){var id=DocNinja.filePreview.CurrentFile();localforage.getItem(id).then(function(obj){obj.payload.mp3=mp3;var updated=DocNinja.Navigation.Icons.Add.Audio(id);document.querySelector("button[data-action='set-audio']").dataset.init="initaudio";closePopover();localforage.setItem(id,obj);if(updated)window.setItemOrder()})}function popover_setLayout(position){var id=DocNinja.filePreview.CurrentFile();localforage.getItem(id).then(function(obj){obj=DocNinja.Page.ModifyDocumentCentering(obj,position);closePopover();var a=document.createElement("a");a.setAttribute("file-id",id);DocNinja.filePreview.Preview(a);a=null;localforage.setItem(id,obj)})}function popover_attachFiles(file){var reader=new FileReader;var id=DocNinja.filePreview.CurrentFile();var fileName=file.name;var dest=document.getElementById("page-file-attachments");reader.onloadend=function(event){localforage.getItem(id).then(function(obj){if(!obj.hasOwnProperty("attachments"))obj.attachments=[];obj.attachments.push({name:fileName,file:event.target.result});dest.insertAdjacentHTML("beforeend",Handlebars.templates["page-attachment"]({name:fileName}));localforage.setItem(id,obj).then(function(){var updated=DocNinja.Navigation.Icons.Add.File(id);if(updated)window.setItemOrder()})})};reader.readAsDataURL(file)}function renameNode(id,a){var p=a.parentNode,text=a.textContent,inp=document.createElement("input");p.removeChild(a);inp.value=text;inp.dataset.oldValue=text;var cancelName=function(){p.removeChild(inp);var l=document.createElement("a");l.dataset.action="preview";l.setAttribute("href","javascript:;");l.textContent=inp.dataset.oldValue;p.appendChild(l);setItemOrder();inp=null;document.body.removeEventListener("click",cancelName);var cp=document.getElementById("preview-frame");if(cp)try{var b=cp.contentWindow.document.body;if(b)b.removeEventListener("click",cancelName)}catch(ex){console.warn(ex)}};inp.onkeydown=function(evt){evt=evt||window.event;var isEscape=false,isEnter=false,tgt=evt.target;if("key"in evt){isEscape=evt.key=="Escape"||evt.key=="Esc";isEnter=evt.key=="Enter"}else{isEscape=evt.keyCode==27;isEnter=evt.keyCode==13}if(!(isEnter||isEscape))return true;if(isEnter){persistProperty(id,"name",inp.value);inp.dataset.oldValue=inp.value}cancelName()};inp.classList.add("rename-page");p.appendChild(inp);document.body.addEventListener("click",cancelName);var cp=document.getElementById("preview-frame");if(cp)try{var b=cp.contentWindow.document.body;if(b)b.addEventListener("click",cancelName)}catch(ex){console.warn(ex)}inp.focus();inp.select()}function hideOverlays(cog){var classes=["drag-over","modal-add","modal-import"];if(cog)classes.push("settings");DOMTokenList.prototype.remove.apply(document.body.classList,classes)}function performAction(tgt,e){hideOverlays();var id=tgt.closest("[data-fileid]")?tgt.closest("[data-fileid]").dataset.fileid:DocNinja.filePreview.CurrentFile(),attrib=tgt.getAttribute("data-action");switch(attrib){case"preview":var a=tgt;if(a.timerID){clearTimeout(a.timerID);a.timerID=null;if(e.which>0&&e.which<13){DocNinja.filePreview.Select(tgt.closest("li"));return}renameNode(id,a)}else{a.timerID=setTimeout(function action_preview_timeout(){a.timerID=null;DocNinja.filePreview.Select(tgt.closest("li"))},250)}break;case"item-increase":DocNinja.PurityControl.Nav.Indent(tgt.closest("li"));break;case"item-decrease":DocNinja.PurityControl.Nav.Outdent(tgt.closest("li"));break;case"upload-kloudless":DocNinja.KLOUDLESS_INPUT.choose();break;case"upload-dropbox":Dropbox.choose({success:function action_upload_dropbox_success(files){for(var i=0;i<files.length;i++){(function(file,index){if(!file.isDir){DocNinja.fileConversion.HandleUrlUpload(file.name,file.link)}})(files[i],i)}},cancel:function(){},linkType:"direct",multiselect:true});break;case"upload-file":document.getElementById("uplControl").click();break;case"plugin-edit":localforage.getItem(id,function action_plugin_edit_get(err,value){var frame=document.getElementById("preview-frame");frame.removeAttribute("data-fileid");frame.setAttribute("src","plugins/"+value.plugin+"/edit.html?"+id)});break;case"plugin-view":localforage.getItem(id,function action_plugin_view_get(err,value){var frame=document.getElementById("preview-frame");frame.removeAttribute("data-fileid");frame.setAttribute("src","plugins/"+value.plugin+"/view.html?"+id)});break;case"plugin-export":localforage.getItem(id,function action_plugin_view_get(err,value){DocNinja.Plugins[value.plugin].Export(id)});break;case"process-paste":var li=document.createElement("li"),url=$("#paste-url-obj").val(),website=$("#paste-url-website").prop("checked")===true,urlOrWebsite=website?"website":"url";$("#paste-url-website").prop("checked",false);$("#paste-url-obj").val("");if(url.length){li.innerHTML=url;li.setAttribute("data-fileid",DocNinja.PurityControl.Nav.GetFileId());DocNinja.navItems.appendChild(li);DocNinja.fileConversion.BeginConversion(null,{url:url},li,urlOrWebsite,"")}break;case"pop-help":PopupCenter(this.href,"Help & Documentation",650,~~($(window).height()/5*4));break;case"confirm-action":$(".confirmation","#delete-page").addClass("active");$('a[data-action="confirm-action"] span').text("Really?");break;case"cancel":$(".confirmation","#delete-page").removeClass("active");$('a[data-action="confirm-action"] span').text("Delete page?");break;case"content-editable":break;case"save-content-editable":DocNinja.filePreview.Save();DocNinja.filePreview.Editing.Disable();break;case"cancel-content-editable":DocNinja.filePreview.Editing.Disable();break;case"shrink":$(document.body).append($("<div id='blocking' />"));localforage.getItem(id,function(err,value){var data=value;var h=Hermite.init("js/workers/hermite/hermite-worker.js"),img=new Image;img.onload=function(){var ratio=aspectRatio(img.naturalWidth,img.naturalHeight,ifrCache.w,ifrCache.h);h.resize({source:img,width:ratio.width,height:ratio.height,quality:.8},function action_shrink_resize_done(output){$("#blocking").remove();img=null;data.payload.image=output.src;localforage.setItem(id,data,function action_shrink_resize_set(){DocNinja.filePreview.Reset();DocNinja.filePreview.Preview(document.querySelector("li[data-fileid='"+id+"']"))})})};img.src=data.payload.image});break;case"trash":trashPage(id);break;case"split":$(document.body).append($("<div id='blocking' />"));localforage.getItem(id,function(err,obj){var n=document.querySelector("li[data-fileid='"+id+"']");DocNinja.Page.Split(n,obj).then(function action_split_done(result){n.parentNode.removeChild(n);setItemOrder();DocNinja.filePreview.Reset();$("#blocking").remove();localforage.removeItem(id)})});break;case"clear-storage":localforage.clear(function(err){document.getElementById("fiddle").innerHTML="";$("#nav-colour").attr("style","");DocNinja.filePreview.Reset();DocNinja.navItems.innerHTML="";if(!DocNinja.options.MUTED)playSound(DocNinja.options.sndtrash);DocNinja.PurityControl.Nav.Check();$("form").each(function(){this.reset()});$(document.body).removeClass("change-settings download-zip").addClass("add-documents");$("button[data-action='add-content']").click();document.body.classList.remove("no-autosplit");$("input[data-action='toggle-no-autosplit']").prop("checked",true);document.body.classList.add("no-pdfembed","no-pdftoolbar");$("input[data-action='toggle-no-pdftoolbar']").prop("checked",false);$("input[data-action='toggle-no-pdfembed']").prop("checked",false);setGlobalVars()});break;case"record-page-audio":if(!document.getElementById("audiorecorder-frame")){var rfrm=document.createElement("iframe");rfrm.setAttribute("seamless",true);rfrm.setAttribute("id","audiorecorder-frame");rfrm.setAttribute("src","/app/plugins/MicRecorderToMp3/edit.html");document.querySelector('div[data-source="set-audio"]>section').appendChild(rfrm)}break;case"upload-page-audio":document.getElementById("pageAudioUpload").click();break;case"trash-page-audio":var ae=document.getElementById("popover_audioElement");localforage.getItem(id).then(function action_trash_audio_get(obj){obj.payload.mp3=undefined;delete obj.payload.mp3;ae.pause();ae.removeAttribute("src");var updated=DocNinja.Navigation.Icons.Remove.Audio(id);if(ae.hasOwnProperty("currentSrc"))ae.currentSrc=undefined;document.querySelector("button[data-action='set-audio']").removeAttribute("data-init");closePopover();localforage.setItem(id,obj);if(updated)window.setItemOrder()});break;case"upload-page-attachments":document.getElementById("fileAttachUpload").click();break;case"trash-page-attachments":localforage.getItem(id).then(function action_trash_page_files(obj){obj.attachments=undefined;delete obj.attachments;localforage.setItem(id,obj);var updated=DocNinja.Navigation.Icons.Remove.File(id);if(updated)window.setItemOrder();closePopover()});break;case"remove-page-attachment":var fn=tgt.getAttribute("data-name");localforage.getItem(id).then(function action_trash_page_files(obj){if(obj.hasOwnProperty("attachments")){[].forEach.call(obj.attachments,function faTrashOne(file,item){if(file.name===fn){obj.attachments[item]=undefined;obj.attachments.splice(item,1);var lne=tgt.closest(".page-attachment-row");lne.parentNode.removeChild(lne)}});if(obj.attachments.length===0){delete obj.attachments;var updated=DocNinja.Navigation.Icons.Remove.File(id);if(updated)window.setItemOrder()}localforage.setItem(id,obj)}});break;default:for(var group in DocNinja.options.actions)if(typeof DocNinja.options.actions[group]==="object")DocNinja.options.actions[group].forEach(function(v){if(v.hasOwnProperty("handler")&&v.handler===attrib){closePopover();if(!DocNinja.options.MUTED)playSound(DocNinja.options.sndpop);DocNinja.Plugins[v.plugin].Add()}})}}function trashPage(id,trashChildren){if(typeof trashChildren!=="undefined"&&trashChildren===true){var li=document.querySelector("li[data-fileid='"+id+"']"),depth=+li.dataset.depth,next=li.nextElementSibling;while(next&&+next.dataset.depth>depth){localforage.removeItem(next.dataset.fileid);next=next.nextElementSibling;next.previousElementSibling.remove()}}localforage.removeItem(id,function(err){$("li[data-fileid='"+id+"']").remove();DocNinja.filePreview.Reset();if(!DocNinja.options.MUTED)playSound(DocNinja.options.sndtrash);setItemOrder()})}function globalClickConsumer(e){var tgt=e.target.closest("[data-action],[data-popover],[data-tab]");if(!tgt)return;if("popover"in tgt.dataset){handlePopover(tgt)}else if("action"in tgt.dataset){handleAction(tgt,e)}else if("tab"in tgt.dataset){changeTab(e)}}function changeTab(e){var tab=e.target.closest("a").dataset.tab;hideOverlays();e.preventDefault();DocNinja.options.loader.show();document.body.classList.remove("settings");if(!DocNinja.options.MUTED)playSound(DocNinja.options.snd);DocNinja.filePreview.Reset();$("li",DocNinja.navItems).removeClass("selected");setTimeout(function(){document.body.classList.remove("add-documents","change-settings","download-zip","undefined");document.body.classList.add(tab);triggerResize();DocNinja.options.loader.hide();DocNinja.routines.PersistSettings("change tab")},DocNinja.options.tabSpeed)}function persistProperty(fileId,propertyName,propertyValue){localforage.getItem(fileId,function persist_property_get(err,value){var data=value||{};data[propertyName]=propertyValue;localforage.setItem(fileId,data)})}function audioVisualize(canvas,stream){var audioCtx=new(window.AudioContext||webkitAudioContext);var source=audioCtx.createMediaStreamSource(stream);var canvasCtx=canvas.getContext("2d");var analyser=audioCtx.createAnalyser();analyser.fftSize=2048;var bufferLength=analyser.frequencyBinCount;var dataArray=new Uint8Array(bufferLength);source.connect(analyser);draw();function draw(){WIDTH=canvas.width;HEIGHT=canvas.height;requestAnimationFrame(draw);analyser.getByteTimeDomainData(dataArray);canvasCtx.fillStyle="rgb(34, 46, 70)";canvasCtx.fillRect(0,0,WIDTH,HEIGHT);canvasCtx.lineWidth=2;canvasCtx.strokeStyle="rgb(87, 183, 220)";canvasCtx.beginPath();var sliceWidth=WIDTH*1/bufferLength;var x=0;for(var i=0;i<bufferLength;i++){var v=dataArray[i]/128;var y=v*HEIGHT/2;if(i===0){canvasCtx.moveTo(x,y)}else{canvasCtx.lineTo(x,y)}x+=sliceWidth}canvasCtx.lineTo(canvas.width,canvas.height/2);canvasCtx.stroke()}}function tXml(t,e){"use strict";var r=(e=e||{}).pos||0,n="<",i="<".charCodeAt(0),a=">",o=">".charCodeAt(0),f="-".charCodeAt(0),l="/".charCodeAt(0),c="!".charCodeAt(0),s="'".charCodeAt(0),u='"'.charCodeAt(0);function d(){for(var e=[];t[r];)if(t.charCodeAt(r)==i){if(t.charCodeAt(r+1)===l)return(r=t.indexOf(a,r))+1&&(r+=1),e;if(t.charCodeAt(r+1)===c){if(t.charCodeAt(r+2)==f){for(;-1!==r&&(t.charCodeAt(r)!==o||t.charCodeAt(r-1)!=f||t.charCodeAt(r-2)!=f||-1==r);)r=t.indexOf(a,r+1);-1===r&&(r=t.length)}else for(r+=2;t.charCodeAt(r)!==o&&t[r];)r++;r++;continue}var n=g();e.push(n)}else{var s=m();s.trim().length>0&&e.push(s),r++}return e}function m(){var e=r;return-2===(r=t.indexOf(n,r)-1)&&(r=t.length),t.slice(e,r+1)}var h="\n\t>/= ";function v(){for(var e=r;-1===h.indexOf(t[r])&&t[r];)r++;return t.slice(e,r)}var p=["img","br","input","meta","link"];function g(){var e={};r++,e.tagName=v();for(var n=!1;t.charCodeAt(r)!==o&&t[r];){var i=t.charCodeAt(r);if(i>64&&i<91||i>96&&i<123){for(var a=v(),f=t.charCodeAt(r);f&&f!==s&&f!==u&&!(f>64&&f<91||f>96&&f<123)&&f!==o;)r++,f=t.charCodeAt(r);if(n||(e.attributes={},n=!0),f===s||f===u){var c=A();if(-1===r)return e}else c=null,r--;e.attributes[a]=c}r++}if(t.charCodeAt(r-1)!==l)if("script"==e.tagName){var m=r+1;r=t.indexOf("<\/script>",r),e.children=[t.slice(m,r-1)],r+=8}else if("style"==e.tagName){m=r+1;r=t.indexOf("</style>",r),e.children=[t.slice(m,r-1)],r+=7}else-1==p.indexOf(e.tagName)&&(r++,e.children=d());else r++;return e}function A(){var e=t[r],n=++r;return r=t.indexOf(e,n),t.slice(n,r)}var C,y=null;if(void 0!==e.attrValue){e.attrName=e.attrName||"id";for(y=[];-1!==(C=void 0,C=new RegExp("\\s"+e.attrName+"\\s*=['\"]"+e.attrValue+"['\"]").exec(t),r=C?C.index:-1);)-1!==(r=t.lastIndexOf("<",r))&&y.push(g()),t=t.substr(r),r=0}else y=e.parseNode?g():d();return e.filter&&(y=tXml.filter(y,e.filter)),e.simplify&&(y=tXml.simplify(y)),y.pos=r,y}tXml.simplify=function(t){var e={};if(!t.length)return"";if(1===t.length&&"string"==typeof t[0])return t[0];for(var r in t.forEach(function(t){if("object"==typeof t){e[t.tagName]||(e[t.tagName]=[]);var r=tXml.simplify(t.children||[]);e[t.tagName].push(r),t.attributes&&(r._attributes=t.attributes)}}),e)1==e[r].length&&(e[r]=e[r][0]);return e},tXml.filter=function(t,e){var r=[];return t.forEach(function(t){if("object"==typeof t&&e(t)&&r.push(t),t.children){var n=tXml.filter(t.children,e);r=r.concat(n)}}),r},tXml.stringify=function(t){var e="";function r(t){if(t)for(var r=0;r<t.length;r++)"string"==typeof t[r]?e+=t[r].trim():n(t[r])}function n(t){for(var n in e+="<"+t.tagName,t.attributes)null===t.attributes[n]?e+=" "+n:-1===t.attributes[n].indexOf('"')?e+=" "+n+'="'+t.attributes[n].trim()+'"':e+=" "+n+"='"+t.attributes[n].trim()+"'";e+=">",r(t.children),e+="</"+t.tagName+">"}return r(t),e},tXml.toContentString=function(t){if(Array.isArray(t)){var e="";return t.forEach(function(t){e=(e+=" "+tXml.toContentString(t)).trim()}),e}return"object"==typeof t?tXml.toContentString(t.children):" "+t},tXml.getElementById=function(t,e,r){var n=tXml(t,{attrValue:e,simplify:r});return r?n:n[0]},tXml.getElementsByClassName=function(t,e,r){return tXml(t,{attrName:"class",attrValue:"[a-zA-Z0-9-s ]*"+e+"[a-zA-Z0-9-s ]*",simplify:r})},tXml.parseStream=function(t,e){if("function"==typeof e&&(cb=e,e=0),"string"==typeof e&&(e=e.length+2),"string"==typeof t){var r=require("fs");t=r.createReadStream(t,{start:e}),e=0}var n=e,i="";return t.on("data",function(e){0,i+=e;for(var r=0;;){n=i.indexOf("<",n)+1;var a=tXml(i,{pos:n,parseNode:!0});if((n=a.pos)>i.length-1||n<r)return void(r&&(i=i.slice(r),n=0,r=0));t.emit("xml",a),r=n}}),t.on("end",function(){console.log("end")}),t},"object"==typeof module&&(module.exports=tXml);function emuToPix(emu){return emu/914400*108}function highestZindex(){return Array.from(document.querySelectorAll("body *")).map(function(a){return parseFloat(window.getComputedStyle(a).zIndex)}).filter(function(a){return!isNaN(a)}).sort(function(a,b){return a-b}).pop()}function popIframe(url){var b=document.createElement("div"),d=document.createElement("iframe"),c=document.createElement("div");o="cs-overlay";if(x=document.querySelector("#"+o))return document.body.style.overflow="auto",document.body.removeChild(x),!1;b.id=o;b.style="position:fixed;top:0;width:100%;height:100%;background:rgba(0,0,0,.5);z-index:"+highestZindex()+1;b.appendChild(d);d.setAttribute("allowfullscreen","true");d.style="position:absolute;width:90%;height:90%;left:5%;top:5%;box-shadow:0 10px 25px rgba(0,0,0,.5);";d.src=url;c.style="position:absolute;top:calc(5% - 24px);left:96%;width:24px;height:24px;cursor:pointer";c.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path stroke="white" stroke-width="3px" d="M0 0l24 24M0 24L24 0"/></svg>';c.onclick=popIframe;b.appendChild(c);document.body.appendChild(b);document.body.style.overflow="hidden";return 1}(function(root,factory){if(typeof define==="function"&&define.amd)define([],factory);else if(typeof exports==="object")module.exports=factory();else root.download=factory()})(this,function(){return function download(data,strFileName,strMimeType){var self=window,defaultMime="application/octet-stream",mimeType=strMimeType||defaultMime,payload=data,url=!strFileName&&!strMimeType&&payload,anchor=document.createElement("a"),toString=function(a){return String(a)},myBlob=self.Blob||self.MozBlob||self.WebKitBlob||toString,fileName=strFileName||"download",blob,reader;myBlob=myBlob.call?myBlob.bind(self):Blob;if(String(this)==="true"){payload=[payload,mimeType];mimeType=payload[0];payload=payload[1]}if(url&&url.length<2048){fileName=url.split("/").pop().split("?")[0];anchor.href=url;if(anchor.href.indexOf(url)!==-1){var ajax=new XMLHttpRequest;ajax.open("GET",url,true);ajax.responseType="blob";ajax.onload=function(e){download(e.target.response,fileName,defaultMime)};setTimeout(function(){ajax.send()},0);return ajax}}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(payload))if(payload.length>1024*1024*1.999&&myBlob!==toString){payload=dataUrlToBlob(payload);mimeType=payload.type||defaultMime}else return navigator.msSaveBlob?navigator.msSaveBlob(dataUrlToBlob(payload),fileName):saver(payload);else if(/([\x80-\xff])/.test(payload)){var i=0,tempUiArr=new Uint8Array(payload.length),mx=tempUiArr.length;for(i;i<mx;++i)tempUiArr[i]=payload.charCodeAt(i);payload=new myBlob([tempUiArr],{type:mimeType})}blob=payload instanceof myBlob?payload:new myBlob([payload],{type:mimeType});function dataUrlToBlob(strUrl){var parts=strUrl.split(/[:;,]/),type=parts[1],indexDecoder=strUrl.indexOf("charset")>0?3:2,decoder=parts[indexDecoder]=="base64"?atob:decodeURIComponent,binData=decoder(parts.pop()),mx=binData.length,i=0,uiArr=new Uint8Array(mx);for(i;i<mx;++i)uiArr[i]=binData.charCodeAt(i);return new myBlob([uiArr],{type:type})}function saver(url,winMode){if("download"in anchor){anchor.href=url;anchor.setAttribute("download",fileName);anchor.className="download-js-link";anchor.innerHTML="downloading...";anchor.style.display="none";anchor.addEventListener("click",function(e){e.stopPropagation();this.removeEventListener("click",arguments.callee)});document.body.appendChild(anchor);setTimeout(function(){anchor.click();document.body.removeChild(anchor);if(winMode===true)setTimeout(function(){self.URL.revokeObjectURL(anchor.href)},250)},66);return true}if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent)){if(/^data:/.test(url))url="data:"+url.replace(/^data:([\w\/\-\+]+)/,defaultMime);if(!window.open(url))if(confirm("Displaying New Document\n\nUse Save As... to download, then click back to return to this page."))location.href=url;return true}var f=document.createElement("iframe");document.body.appendChild(f);if(!winMode&&/^data:/.test(url))url="data:"+url.replace(/^data:([\w\/\-\+]+)/,defaultMime);f.src=url;setTimeout(function(){document.body.removeChild(f)},333)}if(navigator.msSaveBlob)return navigator.msSaveBlob(blob,fileName);if(self.URL)saver(self.URL.createObjectURL(blob),true);else{if(typeof blob==="string"||blob.constructor===toString)try{return saver("data:"+mimeType+";base64,"+self.btoa(blob))}catch(y){return saver("data:"+mimeType+","+encodeURIComponent(blob))}reader=new FileReader;reader.onload=function(e){saver(this.result)};reader.readAsDataURL(blob)}return true}});function sanitizeFilename(input,dfault){var illegalRe=/[\/\?<>\\:\*\|":]/g;var controlRe=/[\x00-\x1f\x80-\x9f]/g;var reservedRe=/^\.+$/;var windowsReservedRe=/^(con|prn|aux|nul|com[0-9]|lpt[0-9])(\..*)?$/i;var result=input.replace(illegalRe,"").replace(controlRe,"").replace(reservedRe,"").replace(windowsReservedRe,"");return result.length?result:dfault||""}"use strict";var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var rec=document.querySelector('button[title="Record"]'),audio=document.querySelector("audio"),accept=document.querySelector('button[title="Use"]'),osc=document.getElementById("oscilloscope"),recorder=new MicRecorder,dataBlob;rec.addEventListener("click",startRecording);function startRecording(){recorder.start().then(function(stream){rec.classList.add("live");osc.classList.add("visible");audio.classList.remove("visible");audioVisualize(osc,stream);rec.removeEventListener("click",startRecording);rec.addEventListener("click",stopRecording);rec.innerHTML='<i class="material-icons">fiber_manual_record</i> Stop';accept.removeEventListener("click",useRecording);accept.classList.remove("visible")}).catch(function(e){console.error(e)})}function stopRecording(){recorder.stop().getMp3().then(function(_ref){var _ref2=_slicedToArray(_ref,2),buffer=_ref2[0];dataBlob=_ref2[1];var file=new File(buffer,"music.mp3",{type:dataBlob.type,lastModified:Date.now()});audio.src=URL.createObjectURL(file);rec.classList.remove("live");rec.innerHTML='<i class="material-icons">fiber_manual_record</i> Start';osc.classList.remove("visible");audio.classList.add("visible");accept.classList.add("visible");rec.removeEventListener("click",stopRecording);rec.addEventListener("click",startRecording);accept.addEventListener("click",useRecording)}).catch(function(e){console.error(e)})}function useRecording(){var reader=new FileReader;reader.onload=function(event){if(parent&&typeof parent.popover_useRecording!=="undefined")parent.popover_useRecording(reader.result)};reader.readAsDataURL(dataBlob)}